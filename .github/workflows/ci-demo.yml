name: CI - JavaScript Tests

# ğŸ‘¶ When should our robot start working?
on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]

# ğŸ‘¶ What jobs should it do?
jobs:
  # Job 1: Run the tests on different Node.js versions
  test:
    # ğŸ‘¶ The robot can test on multiple versions at once!
    strategy:
      matrix:
        node-version: [18.x, 20.x, 22.x]
        os: [windows-latest]
    
    runs-on: ${{ matrix.os }}
    
    steps:
      # Step 1: Get the code
      - name: ğŸ—ï¸ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Get all history for better Git info
      
      # Step 2: Setup Node.js
      - name: âš™ï¸ Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'  # ğŸ‘¨â€ğŸ’» This caches node_modules for faster runs!
      
      # Step 3: Install dependencies
      - name: ğŸ“¦ Install dependencies
        run: npm ci  # ğŸ‘¨â€ğŸ’» 'npm ci' is faster and more reliable for CI than 'npm install'
      
      # Step 4: Run the tests
      - name: ğŸ§ª Run tests
        run: npm test
      
      # Step 5: Upload test coverage as artifact (optional but cool)
      - name: ğŸ“¤ Upload test results
        if: always()  # ğŸ‘¨â€ğŸ’» Run even if tests fail
        uses: actions/upload-artifact@v4
        with:
          name: test-results-node-${{ matrix.node-version }}
          path: |
            coverage/
            junit.xml
  
  # Job 2: Lint the code (Optional bonus to show multiple jobs)
  lint:
    needs: test  # ğŸ‘¨â€ğŸ’» This job only runs if 'test' job succeeds
    runs-on: windows-latest
    
    steps:
      - name: ğŸ—ï¸ Checkout repository
        uses: actions/checkout@v4
      
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
      
      - name: ğŸ“¦ Install dependencies
        run: npm ci
      
      - name: ğŸ” Run ESLint (if you had it)
        run: |
          # This shows how you could add linting
          # For demo, we'll just check formatting
          echo "Code style check passed!"
          echo "In a real project, you might run: npx eslint src/"
  
  # Job 3: Build check (shows job dependency)
  build-check:
    needs: test  # ğŸ‘¨â€ğŸ’» Depends on test job
    runs-on: windows-latest
    
    steps:
      - name: ğŸ—ï¸ Checkout repository
        uses: actions/checkout@v4
      
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
      
      - name: ğŸ“¦ Install dependencies
        run: npm ci
      
      - name: ğŸ› ï¸ Check if it builds
        run: |
          echo "Verifying the application builds..."
          # This would normally run your build command
          # For demo: just check the main file loads
          node -c src/calculator.js && echo "âœ… Syntax check passed!"